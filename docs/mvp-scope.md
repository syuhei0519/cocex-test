# 家計簿アプリ MVP ユースケース定義

## 0. ゴール
- 個人利用者が日々の収支を簡単に記録し、月次で状況を把握できる。
- 予算と実績の差異を把握し、超過しそうなカテゴリを早期に認識できる。
- 最小構成で安定運用できるよう、将来の機能追加に備えた API 契約とデータ構造を確立する。

## 1. 優先度の定義
- **MUST（必須）**：初回リリースに不可欠。ここが揃っていないと価値が提供できない。
- **SHOULD（準必須）**：リリース時点で実装したいが、時間的に難しければ次フェーズに延期可能。
- **COULD（オプション）**：後続イテレーションで検討。設計時のみ考慮し、実装は範囲外。

## 2. ドメイン別ユースケース（MVP 範囲）

### 2.1 User ドメイン
- **MUST**
  - メールアドレス＋パスワードによるユーザー登録（確認メール送信あり）
  - ログイン／ログアウト、アクセストークン発行（Sanctum）
  - プロファイル編集（名称、表示通貨、言語）
  - パスワードリセット（メールリンク）
- **SHOULD**
  - 二段階認証の準備（設定画面とシークレット保管のみ、配信は Notifications と連携）
  - 利用規約／プライバシーポリシー同意管理
- **COULD**
  - ソーシャルログイン（Google / Apple）
  - 招待機能（複数ユーザー共同管理）

### 2.2 Accounting ドメイン
- **MUST**
  - 口座の 생성／編集／アーカイブ（用途：現金、銀行、クレジットなど）
  - 収支取引の登録／編集／削除（単一明細）
  - 取引一覧の検索・フィルタ（期間、カテゴリ、口座、金額範囲）
  - カテゴリの CRUD（階層構造は 1 階層まで）
  - 支払い方法（支出手段）の登録・編集
  - CSV エクスポート（指定期間の取引）
- **SHOULD**
  - 定期取引（毎月の固定費など）の事前登録
  - 添付ファイル（レシート画像）のアップロード（S3 互換ストレージ）
  - CSV インポート（フォーマット限定）
- **COULD**
  - OCR 取り込み（手入力補助）
  - 金融機関 API 連携（自動取得）

### 2.3 Budgeting ドメイン
- **MUST**
  - 月次予算のカテゴリ別設定（通貨単位）
  - 前月予算のコピー
  - 実績との差分表示（合計とカテゴリ別）
- **SHOULD**
  - 進捗率表示（％）と色分けケース
  - ユーザー定義のアラート閾値（％）設定
- **COULD**
  - 予算テンプレートの複数保存
  - 期間を跨ぐカスタム予算（例：四半期）

### 2.4 Reporting ドメイン
- **MUST**
  - 月次ダッシュボード API（収入合計、支出合計、差額、カテゴリ別トップ5）
  - 任意期間の集計 API（折れ線・棒グラフ用データ）
  - 月次サマリー PDF（簡易テンプレート）出力リクエスト
- **SHOULD**
  - ダッシュボードウィジェットの簡易配置設定（順序／表示有無）
  - 前年同月比較データの提供
- **COULD**
  - カスタムレポートビルダ
  - 定期レポート自動配信（Notifications と連携）

### 2.5 Notifications ドメイン
- **MUST**
  - メール通知送信基盤（SES 等）とテンプレート管理
  - 予算超過アラート（Budgeting からイベント受信、メール送信）
  - パスワードリセット等のトランザクションメール対応
- **SHOULD**
  - アプリ内通知一覧（React 側で表示）
  - 通知既読管理 API
- **COULD**
  - プッシュ通知（モバイルブラウザ、PWA）
  - LINE 等外部チャネル連携

### 2.6 Integrations ドメイン
- **MUST**
  - Webhook エンドポイントの雛形（CSRF/署名検証の枠だけ用意）
  - 外部連携設定のプレースホルダ（UI と API の骨組み）
- **SHOULD**
  - レシート OCR サービスとの連携設定（API キー保管）
- **COULD**
  - 各種金融機関連携の OAuth フロー

## 3. フロントエンド（React）側の必須ユースケース
- **MUST**
  - 認証フロー（登録／ログイン／リセット）画面
  - ダッシュボード画面（Reporting API 連携）
  - 取引一覧／詳細／登録フォーム
  - カテゴリ・口座管理 UI
  - 月次予算設定／実績比較 UI
  - 通知一覧（メール送信のみでも履歴表示）
  - 設定画面（プロフィール、通貨、言語）
- **SHOULD**
  - 定期取引の管理 UI
  - ダッシュボードウィジェットの簡易編集
  - 予算アラート閾値の UI
- **COULD**
  - レポート PDF ダウンロード履歴
  - PWA 対応（オフラインキャッシュ）

## 4. 非機能観点での必須要件
- **MUST**
  - API 応答 95 パーセンタイル 300ms 以内（MVP 規模）
  - エラーハンドリングとバリデーションエラー共通レスポンス仕様の策定
  - 認証・認可（Sanctum）と CSRF 対策（Cookie 認証の場合）
  - MySQL バックアップポリシー（最低 1 日 1 回）とリストア手順
  - 基本的な監視（エラーログ、ジョブ失敗通知、稼働状況ヘルスチェック）
- **SHOULD**
  - オブザーバビリティツール（Sentry or Bugsnag）導入
  - インフラ IaC（Terraform or Pulumi）の下準備
- **COULD**
  - 本番・ステージングの自動デプロイパイプライン
  - フロントエンドのパフォーマンス計測（Lighthouse CI）

## 5. スコープ外（将来のバックログとして保持）
- 多人数での家計共有（権限管理、世帯機能）
- オフライン対応の厚み（ローカル保存、同期）
- 金融機関自動連携と支出の自動分類
- AI による分析レコメンド（例：節約提案）
- 課金／サブスクリプションモデル

## 6. 次ステップ
1. MVP ユースケースに基づき、API エンドポイントと画面モックの優先順を決める。
2. OpenAPI 仕様ドラフト作成（MUST ユースケースをカバー）。
3. バックログ管理ツール（GitHub Projects 等）にトラックするチケットを作成し、MUST → SHOULD の順で着手。

---
作成日：2025-10-23  
作成者：開発チーム（ドラフト）
